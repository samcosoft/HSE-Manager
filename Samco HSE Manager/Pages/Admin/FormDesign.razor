@page "/formdesign"
@using Samco_HSE.HSEData
@using FilterType = Syncfusion.Blazor.Grids.FilterType
@attribute [Authorize(Roles = "Owner,Admin")]

<PageTitle>مدیریت فرم‌ها</PageTitle>

<MudCard Style="h-100">
    <MudCardHeader>
        <MudPaper Elevation="3" Width="100%" Class="pa-3">
            <MudGrid>
                <MudItem>
                    <MudText Typo="Typo.h5">مدیریت فرم‌ها</MudText>
                </MudItem>
                <MudItem>
                    <MudButton Color="Color.Primary" Variant="Variant.Filled" StartIcon="fas fa-plus" OnClick="AttachFile">افزودن فایل</MudButton>
                </MudItem>
            </MudGrid>
        </MudPaper>
    </MudCardHeader>
    <MudCardContent>
        <SfGrid @ref="FormGrid" ID="formGrid" DataSource="@HseForms" AllowPaging="true" AllowSorting="true" AllowFiltering="true" EnableStickyHeader="true"
                AllowGrouping="true" Toolbar="@(new[] { "Add", "Edit", "Delete", "Excel Export", "Search", "ColumnChooser" })" ClipMode="ClipMode.EllipsisWithTooltip"
                AllowResizing="true" ShowColumnChooser="true" EnableAdaptiveUI="true" AdaptiveUIMode="AdaptiveMode.Mobile"
                AllowExcelExport="true" Width="100%">
            <GridEvents TValue="HSEForm" OnActionBegin="FormGrid_Action"
                        OnToolbarClick="FormToolbarClickHandler" />
            <GridFilterSettings Type="FilterType.Excel" />
            <GridColumns>
                <GridColumn HeaderText="ردیف" Field="Oid" IsPrimaryKey="true" Visible="false" />
                <GridColumn HeaderText="عنوان" Field="Title" AutoFit="true" />
                <GridColumn HeaderText="کد فرم" Field="Code" AutoFit="true" />
                <GridColumn HeaderText="نسخه" Field="Revision" AutoFit="true" />
                <GridColumn HeaderText="تاریخ بازبینی" Field="Code" AutoFit="true" />
                <GridColumn HeaderText="دسترسی‌ها" Field="AccessGroup" AutoFit="true" />
            </GridColumns>
            <GridEditSettings AllowAdding="true" AllowDeleting="true" AllowEditing="true" AllowEditOnDblClick="true" Mode="EditMode.Dialog"
                              ShowDeleteConfirmDialog="true" Dialog="@SamcoSoftShared.GeneralGridEditOption">
                <Validator>
                    <DataAnnotationsValidator />
                </Validator>
                <Template Context="editFormContext">
                    @{
                        var form = editFormContext as HSEForm;
                    }
                    <MudGrid>
                        <MudItem md="4" sm="12">
                            <MudTextField Label="عنوان فرم:" @bind-Value="@form!.Title" Variant="Variant.Text" Placeholder="الزامی" />
                        </MudItem>
                        <MudItem md="4" sm="12">
                            <MudTextField Label=":کد فرم" @bind-Value="@form!.Title" Variant="Variant.Text" Placeholder="الزامی" Class="ltr" />
                        </MudItem>
                        <MudItem md="4" sm="12">
                            <MudNumericField Label="نسخه فرم:" T="short" Min="1" Max="255" />
                        </MudItem>
                        <MudItem md="4" sm="12">
                            <MudField Label="تاریخ بازبینی:" DisableUnderLine="true">
                                <SamcoDateSelector @bind-DateNotNull="@form!.RevDate" DefaultCalendar="SamcoDateSelector.CalendarType.Persian" />
                            </MudField>
                        </MudItem>
                        <MudItem md="4" sm="12">
                            <MudField Label="استفاده کنندگان:" DisableUnderLine="true">
                                <SfMultiSelect TItem="string" TValue="string[]" DataSource="@RigRoles"
                                               @bind-Value="@_accessGroup" Placeholder="الزامی" Mode="VisualMode.CheckBox"
                                               AllowFiltering="true" FilterBarPlaceholder="برای جستجو تایپ کنید..." FilterType="Syncfusion.Blazor.DropDowns.FilterType.Contains"
                                               ShowClearButton="true" SelectAllText="انتخاب همه" ShowSelectAll="true"
                                               UnSelectAllText="حذف همه" />
                            </MudField>
                        </MudItem>
                        <MudField Label="کلمات کلیدی:" DisableUnderLine="true">
                            <SfMultiSelect TItem="string" TValue="string[]" DataSource="@Keywords"
                                           @bind-Value="@_formKeywords" Mode="VisualMode.CheckBox"
                                           AllowFiltering="true" FilterBarPlaceholder="برای جستجو تایپ کنید..." FilterType="Syncfusion.Blazor.DropDowns.FilterType.Contains"
                                           ShowClearButton="true" SelectAllText="انتخاب همه" ShowSelectAll="true"
                                           UnSelectAllText="حذف همه" />
                        </MudField>
                    </MudGrid>
                </Template>
            </GridEditSettings>
        </SfGrid>
    </MudCardContent>
</MudCard>