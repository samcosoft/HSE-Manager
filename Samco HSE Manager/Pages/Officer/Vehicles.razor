@page "/vehicle"
@attribute [Authorize(Roles = "Owner,Admin,Supervisor,Officer")]
@using Samco_HSE.HSEData
@using FilterType = Syncfusion.Blazor.Grids.FilterType

<PageTitle>مدیریت ماشین آلات</PageTitle>

<MudCard>
    <MudCardHeader>
        <MudPaper Elevation="3" Width="100%" Class="pa-3">
            <MudGrid>
                <MudItem>
                    <MudText Typo="Typo.h5">لیست ماشین آلات سبک و سنگین</MudText>
                </MudItem>
                @* <MudItem> *@
                @*     <MudButtonGroup Color="Color.Primary" Variant="Variant.Filled"> *@
                @*         <MudButton StartIcon="fas fa-hat" IconColor="Color.Warning">تحویل تجهیزات</MudButton> *@
                @*         <MudButton StartIcon="fas fa-info" IconColor="Color.Error">نمایش جزئیات</MudButton> *@
                @*     </MudButtonGroup> *@
                @* </MudItem> *@
            </MudGrid>
        </MudPaper>
    </MudCardHeader>
    <MudCardContent>
        <SfGrid @ref="VehicleGrid" ID="vehicleGrid" DataSource="@VehiclesList" AllowPaging="true" AllowSorting="true" AllowFiltering="true" EnableStickyHeader="true"
                AllowGrouping="true" Toolbar="@(new[] { "Add", "Edit", "Delete", "Excel Export", "Search", "ColumnChooser" })" ClipMode="ClipMode.EllipsisWithTooltip"
                AllowResizing="true" ShowColumnChooser="true" EnableAdaptiveUI="true" AdaptiveUIMode="AdaptiveMode.Mobile"
                AllowExcelExport="true" Width="100%">
            <GridEvents TValue="Vehicle" OnActionBegin="VehicleGrid_Action"
                        OnToolbarClick="VehicleToolbarClickHandler" RowDataBound="Customize_Row"/>
            <GridFilterSettings Type="FilterType.Excel"/>
            <GridColumns>
                <GridColumn HeaderText="ردیف" Field="Oid" IsIdentity="true" IsPrimaryKey="true" Visible="false"/>
                <GridColumn HeaderText="دکل / دفتر" Field="RigNo.Name" AutoFit="true"/>
                <GridColumn HeaderText="نوع وسیله" Field="Name" MinWidth="400" AutoFit="true"/>
                <GridColumn HeaderText="شماره پلاک" Field="PlateNo" MinWidth="150" AutoFit="true"/>
                <GridColumn Field="ProdDate" HeaderText="سال تولید" MinWidth="180" Format="d" AutoFit="true"/>
                <GridColumn Field="LastCheckDate" HeaderText="تاریخ اعتبار گواهی فنی" MinWidth="180" AutoFit="true"/>
                <GridColumn Field="InsuranceDate" HeaderText="تاریخ بیمه‌نامه" MinWidth="180" AutoFit="true"/>
                <GridColumn Field="Driver.PersonnelName" HeaderText="نام راننده" MinWidth="100" AutoFit="true"/>
            </GridColumns>
            <GridEditSettings AllowAdding="true" AllowDeleting="true" AllowEditing="true" AllowEditOnDblClick="true" Mode="EditMode.Dialog"
                              ShowDeleteConfirmDialog="true" Dialog="@SamcoSoftShared.GeneralGridEditOption">
                <Validator>
                    <DataAnnotationsValidator/>
                </Validator>
                <Template Context="editFormContext">
                    @{
                        var vehicle = (Vehicle)editFormContext;
                    }
                    <MudRTLProvider RightToLeft="true">
                        <MudGrid>
                            <MudItem md="4" sm="12">
                                <MudField Label="محل فعالیت:" DisableUnderLine="true">
                                    <SamcoRigSelector @bind-SelectedRig="@vehicle.RigNo" Session="Session1" DataSource="Rigs"/>
                                </MudField>
                            </MudItem>
                            <MudItem md="4" sm="12">
                                <MudField Label="نوع وسیله:" DisableUnderLine="true">
                                    <SfComboBox TItem="string" TValue="string" Placeholder="الزامی" AllowFiltering="true"
                                                FilterType="Syncfusion.Blazor.DropDowns.FilterType.Contains"
                                                DataSource="@_category" @bind-Value="@vehicle.Name">
                                    </SfComboBox>
                                </MudField>
                            </MudItem>
                            <MudItem md="4" sm="12">
                                <MudTextField Label="شماره پلاک:" @bind-Value="@vehicle.PlateNo" Placeholder="الزامی"/>
                            </MudItem>
                            <MudItem md="4" sm="12">
                                <MudNumericField T="short" @bind-Value="@vehicle!.ProdDate" Label="سال تولید:" Adornment="Adornment.Start"
                                                 Min="1340" Max="2100" Step="1"/>
                            </MudItem>
                            <MudItem md="4" sm="12">
                                <MudField Label="راننده:" DisableUnderLine="true">
                                    <SamcoPersonnelSelector DataSource="DriverList" @bind-SelectedPersonnel="@vehicle.Driver" Session="Session1"/>
                                </MudField>
                            </MudItem>
                            <MudItem md="4" sm="12">
                                <MudField Label="تاریخ اعتبار معاینه فنی:" DisableUnderLine="true">
                                    <SamcoDateSelector @bind-Date="@vehicle.LastCheckDate" DefaultCalendar="SamcoDateSelector.CalendarType.Persian"/>
                                </MudField>
                            </MudItem>
                            <MudItem md="4" sm="12">
                                <MudField Label="تاریخ اعتبار بیمه:" DisableUnderLine="true">
                                    <SamcoDateSelector @bind-Date="@vehicle.InsuranceDate" DefaultCalendar="SamcoDateSelector.CalendarType.Persian"/>
                                </MudField>
                            </MudItem>
                        </MudGrid>
                    </MudRTLProvider>
                </Template>
            </GridEditSettings>
        </SfGrid>
    </MudCardContent>
</MudCard>