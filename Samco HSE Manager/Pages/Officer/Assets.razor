@page "/asset"
@using Samco_HSE.HSEData
@using FilterType = Syncfusion.Blazor.Grids.FilterType


@attribute [Authorize(Roles = "Owner,Admin,Supervisor,Officer")]
<PageTitle>مدیریت تجهیزات ملکی</PageTitle>

<MudCard>
    <MudCardHeader>
        <MudPaper Elevation="3" Width="100%" Class="pa-3">
            <MudText Typo="Typo.h5">مدیریت تجهیزات ملکی</MudText>
        </MudPaper>
    </MudCardHeader>
    <MudCardContent>
        <SfGrid @ref="AssetGrid" ID="assetGrid" DataSource="@AssetsList" AllowPaging="true" AllowSorting="true" AllowFiltering="true" EnableStickyHeader="true"
                AllowGrouping="true" Toolbar="@(new[] { "Add", "Edit", "Delete", "Excel Export", "Search", "ColumnChooser" })" ClipMode="ClipMode.EllipsisWithTooltip"
                AllowResizing="true" ShowColumnChooser="true" EnableAdaptiveUI="true" AdaptiveUIMode="AdaptiveMode.Mobile"
                AllowExcelExport="true" Width="100%" EnablePersistence="true">
            <GridEvents TValue="Asset" OnActionBegin="AssetGrid_Action"
                        OnToolbarClick="ToolbarClickHandler" RowDataBound="Customize_Row"/>
            <GridFilterSettings Type="FilterType.Excel"/>
            <GridColumns>
                <GridColumn HeaderText="ردیف" Field="Oid" IsIdentity="true" IsPrimaryKey="true" Visible="false"/>
                @* <GridColumn HeaderText="دکل / دفتر" Field="RigNo.Name"/> *@
                <GridColumn HeaderText="نام تجهیز" Field="Name"/>
                <GridColumn HeaderText="مالکیت" Field="Owner"/>
                <GridColumn HeaderText="شماره سریال" Field="Serial"/>
                <GridColumn HeaderText="محل نصب یا قرارگیری" Field="Position" MinWidth="250"/>
                <GridColumn HeaderText="وضعیت" Field="Status" MinWidth="150"/>
                <GridColumn HeaderText="انقضای گواهی" Field="ExpireDate" MinWidth="150"/>
                <GridColumn HeaderText="توضیحات" Field="Comment" MinWidth="400"/>
            </GridColumns>
            <GridEditSettings AllowAdding="true" AllowDeleting="true" AllowEditing="true" AllowEditOnDblClick="true" Mode="EditMode.Dialog"
                              ShowDeleteConfirmDialog="true" Dialog="@SamcoSoftShared.GeneralGridEditOption">
                <Validator>
                    <DataAnnotationsValidator/>
                </Validator>
                <Template Context="editFormContext">
                    @{
                        var asset = editFormContext as Asset;
                    }

                    <MudRTLProvider RightToLeft="true">
                        <MudGrid>
                            <MudItem md="4" sm="12">
                                <MudTextField Label="نام تجهیز:" AutoFocus="true" @bind-Value="@(asset.Name)" Placeholder="الزامی"/>
                            </MudItem>
                            <MudItem md="4" sm="12">
                                <MudField Label="نام دکل / پالایشگاه:" DisableUnderLine="true">
                                    <SamcoRigSelector DataSource="Rigs" @bind-SelectedRig="@asset.RigNo" Session="Session1"/>
                                </MudField>
                            </MudItem>
                            <MudItem md="4" sm="12">
                                <MudField Label="مالکیت:" DisableUnderLine="true">
                                    <SfComboBox TItem="string" TValue="string" Placeholder="الزامی"
                                                DataSource="@_owners" @bind-Value="@asset.Owner">
                                    </SfComboBox>
                                </MudField>
                            </MudItem>
                            <MudItem md="4" sm="12">
                                <MudTextField Label="شماره سریال:" @bind-Value="@(asset.Serial)"/>
                            </MudItem>
                            <MudItem md="4" sm="12">
                                <MudTextField Label="محل نصب یا قرارگیری:" @bind-Value="@(asset.Position)"/>
                            </MudItem>
                            <MudItem md="4" sm="12">
                                <MudField Label="وضعیت:" DisableUnderLine="true">
                                    <SfComboBox TItem="string" TValue="string"
                                                DataSource="@_status" Placeholder="الزامی"
                                                @bind-Value="@asset.Status">
                                    </SfComboBox>
                                </MudField>
                            </MudItem>
                            <MudItem md="4" sm="12">
                                <MudField Label="انقضای گواهی:" DisableUnderLine="true">
                                    <SamcoDateSelector @bind-Date="@asset.ExpireDate" DefaultCalendar="SamcoDateSelector.CalendarType.Persian"/>
                                </MudField>
                            </MudItem>
                            <MudItem md="4" sm="12">
                                <MudTextField Label="توضیحات:" @bind-Value="@(asset.Comment)"/>
                            </MudItem>
                        </MudGrid>
                    </MudRTLProvider>
                </Template>
            </GridEditSettings>
        </SfGrid>
    </MudCardContent>
</MudCard>