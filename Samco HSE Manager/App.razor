@using Samco_HSE.HSEData
@using DevExpress.Data.Filtering
@using Samco_HSE_Manager.Pages
@inject IDataLayer DataLayer

<CascadingAuthenticationState>
    <Router AppAssembly="@typeof(App).Assembly">
        <Found Context="routeData">
            @*<RouteView RouteData="@routeData" DefaultLayout="@typeof(MainLayout)" />*@
            <AuthorizeRouteView RouteData="@routeData" DefaultLayout="@typeof(MainLayout)">
                <Authorizing>
                    <MudCard>
                        <MudCardContent>
                            <MudText Typo="Typo.body1">در حال بررسی سطح دسترسی...</MudText>
                            <hr class="my-3">
                            <MudProgressLinear Color="Color.Primary" Striped="true" Indeterminate="true"/>
                        </MudCardContent>
                    </MudCard>
                </Authorizing>
                <NotAuthorized>
                    @*  <MudAlert Variant="Variant.Filled" Severity="Severity.Error" ContentAlignment="HorizontalAlignment.Right">با عرض پوزش، شما اجازه دسترسی به این صفحه را ندارید.</MudAlert> *@
                   <LoginRedirect />
                </NotAuthorized>
            </AuthorizeRouteView>
        </Found>
        <NotFound>
            <PageTitle>صفحه پیدا نشد</PageTitle>
            <LayoutView Layout="@typeof(MainLayout)">
                <MudAlert Variant="Variant.Filled" Severity="Severity.Error" ContentAlignment="HorizontalAlignment.Right">با عرض پوزش، این صفحه وجود ندارد.</MudAlert>
            </LayoutView>
        </NotFound>
    </Router>
</CascadingAuthenticationState>

@{
    //First startup
    using (var session1 = new Session(DataLayer))
    {
        var usr = session1.FindObject<User>(new BinaryOperator("Username", "admin"));
        if (usr == null)
        {
            var adminUser = new User(session1) { Username = "admin", 
                Password = BCrypt.Net.BCrypt.EnhancedHashPassword("admin"), 
                SiteRole = "Owner", PersonnelName = "مدیر سیستم", DashboardId = "Admin"};
            adminUser.Save();
        }
    }
}